<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>My First Post | My New Hugo Site</title><meta name=keywords content><meta name=description content="用户中心直播笔记（完整版） 目标：完整了解做项目的思路，接触一些企业级的开发技术，让大家之后都能轻松做出管理系统！
项目源码 用户中心前端项目源码：http://gitlab.code-nav.cn/root/user-center-frontend
用户中心后端项目源码：http://gitlab.code-nav.cn/root/user-center-backend
企业做项目流程 需求分析 => 设计（概要设计、详细设计）=> 技术选型 => 初始化 / 引入需要的技术 => 写 Demo => 写代码（实现业务逻辑） => 测试（单元测试、系统测试）=> 代码提交 / 代码评审 => 部署 => 发布上线
需求分析  登录 / 注册 用户管理（仅管理员可见）对用户的查询或者修改 用户校验（仅星球用户可见）  技术选型 前端：三件套 + React + 组件库 Ant Design + Umi + Ant Design Pro（现成的管理系统）
后端：
 java spring（依赖注入框架，帮助你管理 Java 对象，集成一些其他的内容） springmvc（web 框架，提供接口访问、restful接口等能力） mybatis（Java 操作数据库的框架，持久层框架，对 jdbc 的封装） mybatis-plus（对 mybatis 的增强，不用写 sql 也能实现增删改查） springboot（快速启动 / 快速集成项目。不用自己管理 spring 配置，不用自己整合各种框架） junit 单元测试库 mysql 数据库  部署：服务器 / 容器（平台）"><meta name=author content><link rel=canonical href=https://nightingale777.github.io/MyBlog/posts/my-first-post/><link crossorigin=anonymous href=/MyBlog/assets/css/stylesheet.min.ec8da366ca2fb647537ccb7a8f6fa5b4e9cd3c7a0d3171dd2d3baad1e49c8bfc.css integrity="sha256-7I2jZsovtkdTfMt6j2+ltOnNPHoNMXHdLTuq0eSci/w=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/MyBlog/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://nightingale777.github.io/MyBlog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://nightingale777.github.io/MyBlog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://nightingale777.github.io/MyBlog/favicon-32x32.png><link rel=apple-touch-icon href=https://nightingale777.github.io/MyBlog/apple-touch-icon.png><link rel=mask-icon href=https://nightingale777.github.io/MyBlog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="My First Post"><meta property="og:description" content="用户中心直播笔记（完整版） 目标：完整了解做项目的思路，接触一些企业级的开发技术，让大家之后都能轻松做出管理系统！
项目源码 用户中心前端项目源码：http://gitlab.code-nav.cn/root/user-center-frontend
用户中心后端项目源码：http://gitlab.code-nav.cn/root/user-center-backend
企业做项目流程 需求分析 => 设计（概要设计、详细设计）=> 技术选型 => 初始化 / 引入需要的技术 => 写 Demo => 写代码（实现业务逻辑） => 测试（单元测试、系统测试）=> 代码提交 / 代码评审 => 部署 => 发布上线
需求分析  登录 / 注册 用户管理（仅管理员可见）对用户的查询或者修改 用户校验（仅星球用户可见）  技术选型 前端：三件套 + React + 组件库 Ant Design + Umi + Ant Design Pro（现成的管理系统）
后端：
 java spring（依赖注入框架，帮助你管理 Java 对象，集成一些其他的内容） springmvc（web 框架，提供接口访问、restful接口等能力） mybatis（Java 操作数据库的框架，持久层框架，对 jdbc 的封装） mybatis-plus（对 mybatis 的增强，不用写 sql 也能实现增删改查） springboot（快速启动 / 快速集成项目。不用自己管理 spring 配置，不用自己整合各种框架） junit 单元测试库 mysql 数据库  部署：服务器 / 容器（平台）"><meta property="og:type" content="article"><meta property="og:url" content="https://nightingale777.github.io/MyBlog/posts/my-first-post/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-06T23:58:12+08:00"><meta property="article:modified_time" content="2022-05-06T23:58:12+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="My First Post"><meta name=twitter:description content="用户中心直播笔记（完整版） 目标：完整了解做项目的思路，接触一些企业级的开发技术，让大家之后都能轻松做出管理系统！
项目源码 用户中心前端项目源码：http://gitlab.code-nav.cn/root/user-center-frontend
用户中心后端项目源码：http://gitlab.code-nav.cn/root/user-center-backend
企业做项目流程 需求分析 => 设计（概要设计、详细设计）=> 技术选型 => 初始化 / 引入需要的技术 => 写 Demo => 写代码（实现业务逻辑） => 测试（单元测试、系统测试）=> 代码提交 / 代码评审 => 部署 => 发布上线
需求分析  登录 / 注册 用户管理（仅管理员可见）对用户的查询或者修改 用户校验（仅星球用户可见）  技术选型 前端：三件套 + React + 组件库 Ant Design + Umi + Ant Design Pro（现成的管理系统）
后端：
 java spring（依赖注入框架，帮助你管理 Java 对象，集成一些其他的内容） springmvc（web 框架，提供接口访问、restful接口等能力） mybatis（Java 操作数据库的框架，持久层框架，对 jdbc 的封装） mybatis-plus（对 mybatis 的增强，不用写 sql 也能实现增删改查） springboot（快速启动 / 快速集成项目。不用自己管理 spring 配置，不用自己整合各种框架） junit 单元测试库 mysql 数据库  部署：服务器 / 容器（平台）"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://nightingale777.github.io/MyBlog/posts/"},{"@type":"ListItem","position":2,"name":"My First Post","item":"https://nightingale777.github.io/MyBlog/posts/my-first-post/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"My First Post","name":"My First Post","description":"用户中心直播笔记（完整版） 目标：完整了解做项目的思路，接触一些企业级的开发技术，让大家之后都能轻松做出管理系统！\n项目源码 用户中心前端项目源码：http://gitlab.code-nav.cn/root/user-center-frontend\n用户中心后端项目源码：http://gitlab.code-nav.cn/root/user-center-backend\n企业做项目流程 需求分析 =\u0026gt; 设计（概要设计、详细设计）=\u0026gt; 技术选型 =\u0026gt; 初始化 / 引入需要的技术 =\u0026gt; 写 Demo =\u0026gt; 写代码（实现业务逻辑） =\u0026gt; 测试（单元测试、系统测试）=\u0026gt; 代码提交 / 代码评审 =\u0026gt; 部署 =\u0026gt; 发布上线\n需求分析  登录 / 注册 用户管理（仅管理员可见）对用户的查询或者修改 用户校验（仅星球用户可见）  技术选型 前端：三件套 + React + 组件库 Ant Design + Umi + Ant Design Pro（现成的管理系统）\n后端：\n java spring（依赖注入框架，帮助你管理 Java 对象，集成一些其他的内容） springmvc（web 框架，提供接口访问、restful接口等能力） mybatis（Java 操作数据库的框架，持久层框架，对 jdbc 的封装） mybatis-plus（对 mybatis 的增强，不用写 sql 也能实现增删改查） springboot（快速启动 / 快速集成项目。不用自己管理 spring 配置，不用自己整合各种框架） junit 单元测试库 mysql 数据库  部署：服务器 / 容器（平台）","keywords":[],"articleBody":"用户中心直播笔记（完整版） 目标：完整了解做项目的思路，接触一些企业级的开发技术，让大家之后都能轻松做出管理系统！\n项目源码 用户中心前端项目源码：http://gitlab.code-nav.cn/root/user-center-frontend\n用户中心后端项目源码：http://gitlab.code-nav.cn/root/user-center-backend\n企业做项目流程 需求分析 = 设计（概要设计、详细设计）= 技术选型 = 初始化 / 引入需要的技术 = 写 Demo = 写代码（实现业务逻辑） = 测试（单元测试、系统测试）= 代码提交 / 代码评审 = 部署 = 发布上线\n需求分析  登录 / 注册 用户管理（仅管理员可见）对用户的查询或者修改 用户校验（仅星球用户可见）  技术选型 前端：三件套 + React + 组件库 Ant Design + Umi + Ant Design Pro（现成的管理系统）\n后端：\n java spring（依赖注入框架，帮助你管理 Java 对象，集成一些其他的内容） springmvc（web 框架，提供接口访问、restful接口等能力） mybatis（Java 操作数据库的框架，持久层框架，对 jdbc 的封装） mybatis-plus（对 mybatis 的增强，不用写 sql 也能实现增删改查） springboot（快速启动 / 快速集成项目。不用自己管理 spring 配置，不用自己整合各种框架） junit 单元测试库 mysql 数据库  部署：服务器 / 容器（平台）\n3 种初始化 Java 项目的方式  GitHub 搜现成的代码 SpringBoot 官方的模板生成器（https://start.spring.io/） 直接在 IDEA 开发工具中生成 ✔  如果要引入 java 的包，可以去 maven 中心仓库寻找（http://mvnrepository.com/）\n数据库设计 什么是数据库？存数据的\n数据库里有什么？数据表（理解为 excel 表格）\njava 操作数据库？程序代替人工\n什么是设计数据库表？ 有哪些表（模型）？表中有哪些字段？字段的类型？数据库字段添加索引？表与表之间的关联？\n举例：性别是否需要加索引？\n用户表设计 id（主键）bigint\nusername 昵称 varchar\nuserAccount 登录账号\navatarUrl 头像 varchar\ngender 性别 tinyint\nuserPassword 密码 varchar\nphone 电话 varchar\nemail 邮箱 varchar\nuserStatus 用户状态 int 0 - 正常\ncreateTime 创建时间（数据插入时间）datetime\nupdateTime 更新时间（数据更新时间）datetime\nisDelete 是否删除 0 1（逻辑删除）tinyint\nuserRole 用户角色 0 - 普通用户 1 - 管理员\n自动生成器的使用 MyBatisX 插件，自动根据数据库生成：\n domain：实体对象 mapper：操作数据库的对象 mapper.xml：定义了 mapper 对象和数据库的关联，可以在里面自己写 SQL service：包含常用的增删改查 serviceImpl：具体实现 service  从而提高开发效率！\n注册逻辑设计  用户在前端输入账户和密码、以及校验码（todo） 校验用户的账户、密码、校验密码，是否符合要求  非空 账户长度 不小于 4 位 密码就 不小于 8 位吧 账户不能重复 账户不包含特殊字符 密码和校验密码相同   对密码进行加密（密码千万不要直接以明文存储到数据库中） 向数据库插入用户数据  登录功能 接口设计 接受参数：用户账户、密码\n请求类型：POST\n请求体：JSON 格式的数据\n 请求参数很长时不建议用 get\n 返回值：用户信息（ 脱敏 ）\n登录逻辑   校验用户账户和密码是否合法\n 非空 账户长度不小于 4 位 密码就不小于 8 位 账户不包含特殊字符    校验密码是否输入正确，要和数据库中的密文密码去对比\n  用户信息脱敏，隐藏敏感信息，防止数据库中的字段泄露\n  我们要记录用户的登录态（session），将其存到服务器上（用后端 SpringBoot 框架封装的服务器 tomcat 去记录）\ncookie\n  返回脱敏后的用户信息\n  实现 控制层 Controller 封装请求\napplication.yml 指定接口全局路径前缀：\nservlet: context-path: /api 控制器注解：\n@RestController 适用于编写 restful 风格的 api，返回值默认为 json 类型 校验写在哪里？\n controller 层倾向于对请求参数本身的校验，不涉及业务逻辑本身（越少越好） service 层是对业务逻辑的校验（有可能被 controller 之外的类调用）  如何知道是哪个用户登录了？  javaweb 这一块的知识\n   连接服务器端后，得到一个 session 状态（匿名会话），返回给前端\n  登录成功后，得到了登录成功的 session，并且给该sessio n设置一些值（比如用户信息），返回给前端一个设置 cookie 的 ”命令“\nsession = cookie\n  前端接收到后端的命令后，设置 cookie，保存到浏览器内\n  前端再次请求后端的时候（相同的域名），在请求头中带上cookie去请求\n  后端拿到前端传来的 cookie，找到对应的 session\n  后端从 session 中可以取出基于该 session 存储的变量（用户的登录信息、登录名）\n  用户管理 接口设计关键：必须鉴权！！！\n 查询用户（允许根据用户名查询） 删除用户  写代码流程  先做设计 代码实现 持续优化！！！（复用代码、提取公共逻辑 / 常量）  前后端交互 前端需要向后端发送请求才能获取数据 / 执行操作。\n怎么发请求：前端使用 ajax 来请求后端\n前端请求库及封装关系   axios 封装了 ajax\n  request 是 ant design 项目又封装了一次\n  追踪 request 源码：用到了 umi 的插件、requestConfig 配置文件\n代理 正向代理：替客户端向服务器发送请求，可以解决跨域问题\n反向代理：替服务器统一接收请求。\n怎么实现代理？\n Nginx 服务器 Node.js 服务器  举例 原本请求：http://localhost:8000/api/user/login\n代理到请求：http://localhost:8080/api/user/login\n前端框架介绍 Ant Design Pro（Umi 框架）权限管理  app.tsx：项目全局入口文件，定义了整个项目中使用的公共数据（比如用户信息） access.ts 控制用户的访问权限  获取初始状态流程：首次访问页面（刷新页面），进入 app.tsx，执行 getInitialState 方法，该方法的返回值就是全局可用的状态值。\nProComponents 高级表单  通过 columns 定义表格有哪些列 columns 属性  dataIndex 对应返回数据对象的属性 title 表格列名 copyable 是否允许复制 ellipsis 是否允许缩略 valueType：用于声明这一列的类型（dateTime、select）    框架关系 Ant Design 组件库 = 基于 React 实现\nAnt Design Procomponents = 基于 Ant Design 实现\nAnt Design Pro 后台管理系统 = 基于 Ant Design + React + Ant Design Procomponents + 其他的库实现\n其他知识 MFSU：前端编译优化\n后端优化 通用返回对象 目的：给对象补充一些信息，告诉前端这个请求在业务层面上是成功还是失败\n200、404、500、502、503\n{  \"name\": \"yupi\" }  ↓  // 成功 {  \"code\": 0 // 业务状态码  \"data\": {  \"name\": \"yupi\"  }, \t\"message\": \"ok\" }   // 错误 {  \"code\": 50001 // 业务状态码  \"data\": null \t\"message\": \"用户操作异常、xxx\" } 自定义错误码，返回类支持返回正常和错误\n封装全局异常处理器 实现   定义业务异常类\n 相对于 java 的异常类，支持更多字段 自定义构造函数，更灵活 / 快捷的设置字段    编写全局异常处理器（利用 Spring AOP，在调用方法前后进行额外的处理）\n  作用  捕获代码中所有的异常，内部消化，让前端得到更详细的业务报错 / 信息 同时屏蔽掉项目框架本身的异常（不暴露服务器内部状态） 集中处理，比如记录日志  前端优化  直播的 0：00 - 0：35 为踩坑过程，可跳过\n 全局响应处理 应用场景：我们需要对接口的 通用响应 进行统一处理，比如从 response 中取出 data；或者根据 code 去集中处理错误，比如用户未登录、没权限之类的。\n优势：不用在每个接口请求中都去写相同的逻辑\n实现：参考你用的请求封装工具的官方文档，比如 umi-request（https://github.com/umijs/umi-request#interceptor、https://blog.csdn.net/huantai3334/article/details/116780020）。如果你用 axios，参考 axios 的文档。\n创建新的文件，在该文件中配置一个全局请求类。在发送请求时，使用我们自己的定义的全局请求类。\n用户校验  仅适用于用户可信的情况\n 先让用户自己填：2 - 5 位编号，全凭自觉。\n后台补充对编号的校验：长度校验、唯一性校验\n前端补充输入框，适配后端。\n 后期拉取星球数据，定期清理违规用户\n 多环境 参考文章：https://blog.csdn.net/weixin_41701290/article/details/120173283\n本地开发：localhost（127.0.0.1）\n多环境：指同一套项目代码在不同的阶段需要根据实际情况来调整配置并且部署到不同的机器上。\n为什么需要？\n 每个环境互不影响 区分不同的阶段：开发 / 测试 / 生产 对项目进行优化：  本地日志级别 精简依赖，节省项目体积 项目的环境 / 参数可以调整，比如 JVM 参数    针对不同环境做不同的事情。\n多环境分类：\n 本地环境（自己的电脑）localhost 开发环境（远程开发）大家连同一台机器，为了大家开发方便 测试环境（测试）开发 / 测试 / 产品，单元测试 / 性能测试 / 功能测试 / 系统集成测试，独立的数据库、独立的服务器 预发布环境（体验服）：和正式环境一致，正式数据库，更严谨，查出更多问题 正式环境（线上，公开对外访问的项目）：尽量不要改动，保证上线前的代码是 “完美” 运行 沙箱环境（实验环境）：为了做实验  前端多环境实战   请求地址\n  开发环境：localhost:8000\n  线上环境：user-backend.code-nav.cn\n  startFront(env) {  if(env === 'prod') {  // 不输出注释  // 项目优化  // 修改请求地址  } else {  // 保持本地开发逻辑  } } 用了 umi 框架，build 时会自动传入 NODE_ENV == production 参数，start NODE_ENV 参数为 development\n  启动方式\n 开发环境：npm run start（本地启动，监听端口、自动更新） 线上环境：npm run build（项目构建打包），可以使用 serve 工具启动（npm i -g serve）    项目的配置\n不同的项目（框架）都有不同的配置文件，umi 的配置文件是 config，可以在配置文件后添加对应的环境名称后缀来区分开发环境和生产环境。参考文档：https://umijs.org/zh-CN/docs/deployment\n 开发环境：config.dev.ts 生产环境：config.prod.ts 公共配置：config.ts 不带后缀    后端多环境实战 SpringBoot 项目，通过 application.yml 添加不同的后缀来区分配置文件\n可以在启动项目时传入环境变量：\njava -jar .\\user-center-backend-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod 主要是改：\n  依赖的环境地址\n  数据库地址\n  缓存地址\n  消息队列地址\n  项目端口号\n    服务器配置\n  项目部署 参考文章：https://www.bilibili.com/read/cv16179200\n需要 Linux 服务器（建议大家用 CentOS 8+ / 7.6 以上）\n原始部署 什么都自己装\n前端 需要 web 服务器：nginx 、apache、tomcat\n安装 nginx 服务器：\n  用系统自带的软件包管理器快速安装，比如 centos 的 yum\n  自己到官网安装（参考文章）\ncurl -o nginx-1.21.6.tar.gz http://nginx.org/download/nginx-1.21.6.tar.gz  tar -zxvf nginx-1.21.6.tar.gz  cd nginx-1.21.6   37 2022-04-17 23:30:09 yum install pcre pcre-devel -y  39 2022-04-17 23:30:59 yum install openssl openssl-devel -y  41 2022-04-17 23:31:57 ./configure --with-http_ssl_module --with-http_v2_module --with-stream  42 2022-04-17 23:32:13 make  43 2022-04-17 23:32:54 make install  48 2022-04-17 23:33:40 ls /usr/local/nginx/sbin/nginx  vim /etc/profile  在最后一行添加：export PATH=$PATH:/usr/local/nginx/sbin\t  nginx   netstat -ntlp 查看启动情况 注意 nginx 权限\n  后端 java、maven\n安装：\nyum install -y java-1.8.0-openjdk*  curl -o apache-maven-3.8.5-bin.tar.gz https://dlcdn.apache.org/maven/maven-3/3.8.5/binaries/apache-maven-3.8.5-bin.tar.gz  git clone xxx 下载代码  打包构建，跳过测试 mvn package -DskipTests  java -jar ./user-center-backend-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod 宝塔 Linux 部署 Linux 运维面板\n官方安装教程：https://www.bt.cn/new/download.html\n方便管理服务器、方便安装软件\n前端托管 前端腾讯云 web 应用托管（比容器化更傻瓜式，不需要自己写构建应用的命令，就能启动前端项目）\n https://console.cloud.tencent.com/webify/new\n  小缺点：需要将代码放到代码托管平台上 优势：不用写命令、代码更新时自动构建  Docker 部署 docker 是容器，可以将项目的环境（比如 java、nginx）和项目的代码一起打包成镜像，所有同学都能下载镜像，更容易分发和移植。\n再启动项目时，不需要敲一大堆命令，而是直接下载镜像、启动镜像就可以了。\ndocker 可以理解为软件安装包。\nDocker 安装：https://www.docker.com/get-started/ 或者宝塔安装\nDockerfile 用于指定构建 Docker 镜像的方法\nDockerfile 一般情况下不需要完全从 0 自己写，建议去 github、gitee 等托管平台参考同类项目（比如 springboot）\nDockerfile 编写：\n FROM 依赖的基础镜像 WORKDIR 工作目录 COPY 从本机复制文件 RUN 执行命令 CMD / ENTRYPOINT（附加额外参数）指定运行容器时默认执行的命令  根据 Dockerfile 构建镜像：\n# 后端 docker build -t user-center-backend:v0.0.1 .  # 前端 docker build -t user-center-front:v0.0.1 . Docker 构建优化：减少尺寸、减少构建时间（比如多阶段构建，可以丢弃之前阶段不需要的内容）\ndocker run 启动：\n# 前端 docker run -p 80:80 -d user-center-frontend:v0.0.1  # 后端 docker run -p 8080:8080 user-center-backend:v0.0.1 虚拟化\n 端口映射：把本机的资源（实际访问地址）和容器内部的资源（应用启动端口）进行关联 目录映射：把本机的端口和容器应用的端口进行关联  进入容器：\ndocker exec -i -t fee2bbb7c9ee /bin/bash 查看进程：\ndocker ps 查看日志：\ndocker logs -f [container-id] 杀死容器：\ndocker kill 强制删除镜像：\ndocker rmi -f Docker 平台部署  云服务商的容器平台（腾讯云、阿里云） 面向某个领域的容器平台（前端 / 后端微信云托管）要花钱！  容器平台的好处：\n 不用输命令来操作，更方便省事 不用在控制台操作，更傻瓜式、更简单 大厂运维，比自己运维更省心 额外的能力，比如监控、告警、其他（存储、负载均衡、自动扩缩容、流水线）  爽就完事了！！！\n绑定域名 前端项目访问流程：用户输入网址 = 域名解析服务器（把网址解析为 ip 地址 / 交给其他的域名解析服务） = 服务器 =（防火墙）= nginx 接收请求，找到对应的文件，返回文件给前端 = 前端加载文件到浏览器中（js、css） = 渲染页面\n后端项目访问流程：用户输入网址 = 域名解析服务器 = 服务器 = nginx 接收请求 = 后端项目（比如 8080端口）\nnginx 反向代理的作用：替服务器接收请求，转发请求\n跨域问题解决 浏览器为了用户的安全，仅允许向 同域名、同端口 的服务器发送请求。\n如何解决跨域？\n最直接的方式：把域名、端口改成相同的\n添加跨域头 让服务器告诉浏览器：允许跨域（返回 cross-origin-allow 响应头）\n1. 网关支持（Nginx） # 跨域配置 location ^~ /api/ {  proxy_pass http://127.0.0.1:8080/api/;  add_header 'Access-Control-Allow-Origin' $http_origin;  add_header 'Access-Control-Allow-Credentials' 'true';  add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';  add_header Access-Control-Allow-Headers '*';  if ($request_method = 'OPTIONS') {  add_header 'Access-Control-Allow-Credentials' 'true';  add_header 'Access-Control-Allow-Origin' $http_origin;  add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';  add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';  add_header 'Access-Control-Max-Age' 1728000;  add_header 'Content-Type' 'text/plain; charset=utf-8';  add_header 'Content-Length' 0;  return 204;  } } 2. 修改后端服务   配置 @CrossOrigin 注解\n  添加 web 全局请求拦截器\n@Configuration public class WebMvcConfg implements WebMvcConfigurer {   @Override  public void addCorsMappings(CorsRegistry registry) {  //设置允许跨域的路径  registry.addMapping(\"/**\")  //设置允许跨域请求的域名  //当**Credentials为true时，**Origin不能为星号，需为具体的ip地址【如果接口不带cookie,ip无需设成具体ip】  .allowedOrigins(\"http://localhost:9527\", \"http://127.0.0.1:9527\", \"http://127.0.0.1:8082\", \"http://127.0.0.1:8083\")  //是否允许证书 不再默认开启  .allowCredentials(true)  //设置允许的方法  .allowedMethods(\"*\")  //跨域允许时间  .maxAge(3600);  } }   定义新的 corsFilter Bean，参考：https://www.jianshu.com/p/b02099a435bd\n  项目优化点  功能扩充  管理员创建用户、修改用户信息、删除用户 上传头像 按照更多的条件去查询用户 更改权限   修改 Bug 项目登录改为分布式 session（单点登录 - redis） 通用性  set-cookie domain 域名更通用，比如改为 *.xxx.com 把用户管理系统 = 用户中心（之后所有的服务都请求这个后端）   后台添加全局请求拦截器（统一去判断用户权限、统一记录请求日志）  ","wordCount":"945","inLanguage":"en","datePublished":"2022-05-06T23:58:12+08:00","dateModified":"2022-05-06T23:58:12+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://nightingale777.github.io/MyBlog/posts/my-first-post/"},"publisher":{"@type":"Organization","name":"My New Hugo Site","logo":{"@type":"ImageObject","url":"https://nightingale777.github.io/MyBlog/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://nightingale777.github.io/MyBlog/ accesskey=h title="My New Hugo Site (Alt + H)">My New Hugo Site</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>My First Post</h1><div class=post-meta><span title="2022-05-06 23:58:12 +0800 +0800">May 6, 2022</span></div></header><div class=post-content><h1 id=用户中心直播笔记完整版>用户中心直播笔记（完整版）<a hidden class=anchor aria-hidden=true href=#用户中心直播笔记完整版>#</a></h1><p>目标：完整了解做项目的思路，接触一些企业级的开发技术，让大家之后都能轻松做出管理系统！</p><h3 id=项目源码>项目源码<a hidden class=anchor aria-hidden=true href=#项目源码>#</a></h3><p>用户中心前端项目源码：http://gitlab.code-nav.cn/root/user-center-frontend</p><p>用户中心后端项目源码：http://gitlab.code-nav.cn/root/user-center-backend</p><h2 id=企业做项目流程>企业做项目流程<a hidden class=anchor aria-hidden=true href=#企业做项目流程>#</a></h2><p>需求分析 => 设计（概要设计、详细设计）=> 技术选型 => 初始化 / 引入需要的技术 => 写 Demo => 写代码（实现业务逻辑） => 测试（单元测试、系统测试）=> 代码提交 / 代码评审 => 部署 => 发布上线</p><h2 id=需求分析>需求分析<a hidden class=anchor aria-hidden=true href=#需求分析>#</a></h2><ol><li>登录 / 注册</li><li>用户管理（仅管理员可见）对用户的查询或者修改</li><li>用户校验（仅星球用户可见）</li></ol><h2 id=技术选型>技术选型<a hidden class=anchor aria-hidden=true href=#技术选型>#</a></h2><p>前端：三件套 + React + 组件库 Ant Design + Umi + Ant Design Pro（现成的管理系统）</p><p>后端：</p><ul><li>java</li><li>spring（依赖注入框架，帮助你管理 Java 对象，集成一些其他的内容）</li><li>springmvc（web 框架，提供接口访问、restful接口等能力）</li><li>mybatis（Java 操作数据库的框架，持久层框架，对 jdbc 的封装）</li><li>mybatis-plus（对 mybatis 的增强，不用写 sql 也能实现增删改查）</li><li>springboot（<strong>快速启动</strong> / 快速集成项目。不用自己管理 spring 配置，不用自己整合各种框架）</li><li>junit 单元测试库</li><li>mysql 数据库</li></ul><p>部署：服务器 / 容器（平台）</p><h2 id=3-种初始化-java-项目的方式>3 种初始化 Java 项目的方式<a hidden class=anchor aria-hidden=true href=#3-种初始化-java-项目的方式>#</a></h2><ol><li>GitHub 搜现成的代码</li><li>SpringBoot 官方的模板生成器（https://start.spring.io/）</li><li>直接在 IDEA 开发工具中生成 ✔</li></ol><p>如果要引入 java 的包，可以去 maven 中心仓库寻找（http://mvnrepository.com/）</p><h2 id=数据库设计>数据库设计<a hidden class=anchor aria-hidden=true href=#数据库设计>#</a></h2><p>什么是数据库？存数据的</p><p>数据库里有什么？数据表（理解为 excel 表格）</p><p>java 操作数据库？程序代替人工</p><h3 id=什么是设计数据库表>什么是设计数据库表？<a hidden class=anchor aria-hidden=true href=#什么是设计数据库表>#</a></h3><p>有哪些表（模型）？表中有哪些字段？字段的类型？数据库字段添加索引？表与表之间的关联？</p><p>举例：性别是否需要加索引？</p><h3 id=用户表设计>用户表设计<a hidden class=anchor aria-hidden=true href=#用户表设计>#</a></h3><p>id（主键）bigint</p><p>username 昵称 varchar</p><p>userAccount 登录账号</p><p>avatarUrl 头像 varchar</p><p>gender 性别 tinyint</p><p>userPassword 密码 varchar</p><p>phone 电话 varchar</p><p>email 邮箱 varchar</p><p>userStatus 用户状态 int 0 - 正常</p><p>createTime 创建时间（数据插入时间）datetime</p><p>updateTime 更新时间（数据更新时间）datetime</p><p>isDelete 是否删除 0 1（逻辑删除）tinyint</p><p>userRole 用户角色 0 - 普通用户 1 - 管理员</p><h3 id=自动生成器的使用>自动生成器的使用<a hidden class=anchor aria-hidden=true href=#自动生成器的使用>#</a></h3><p>MyBatisX 插件，自动根据数据库生成：</p><ul><li>domain：实体对象</li><li>mapper：操作数据库的对象</li><li>mapper.xml：定义了 mapper 对象和数据库的关联，可以在里面自己写 SQL</li><li>service：包含常用的增删改查</li><li>serviceImpl：具体实现 service</li></ul><p>从而提高开发效率！</p><h2 id=注册逻辑设计>注册逻辑设计<a hidden class=anchor aria-hidden=true href=#注册逻辑设计>#</a></h2><ol><li>用户在前端输入账户和密码、以及校验码（todo）</li><li>校验用户的账户、密码、校验密码，是否符合要求<ol><li>非空</li><li>账户长度 <strong>不小于</strong> 4 位</li><li>密码就 <strong>不小于</strong> 8 位吧</li><li>账户不能重复</li><li>账户不包含特殊字符</li><li>密码和校验密码相同</li></ol></li><li>对密码进行加密（密码千万不要直接以明文存储到数据库中）</li><li>向数据库插入用户数据</li></ol><h2 id=登录功能>登录功能<a hidden class=anchor aria-hidden=true href=#登录功能>#</a></h2><h3 id=接口设计>接口设计<a hidden class=anchor aria-hidden=true href=#接口设计>#</a></h3><p>接受参数：用户账户、密码</p><p>请求类型：POST</p><p>请求体：JSON 格式的数据</p><blockquote><p>请求参数很长时不建议用 get</p></blockquote><p>返回值：用户信息（ <strong>脱敏</strong> ）</p><h3 id=登录逻辑>登录逻辑<a hidden class=anchor aria-hidden=true href=#登录逻辑>#</a></h3><ol><li><p>校验用户账户和密码是否合法</p><ol><li>非空</li><li>账户长度不小于 4 位</li><li>密码就不小于 8 位</li><li>账户不包含特殊字符</li></ol></li><li><p>校验密码是否输入正确，要和数据库中的密文密码去对比</p></li><li><p>用户信息脱敏，隐藏敏感信息，防止数据库中的字段泄露</p></li><li><p>我们要记录用户的登录态（session），将其存到服务器上（用后端 SpringBoot 框架封装的服务器 tomcat 去记录）</p><p>cookie</p></li><li><p>返回脱敏后的用户信息</p></li></ol><h3 id=实现>实现<a hidden class=anchor aria-hidden=true href=#实现>#</a></h3><p>控制层 Controller 封装请求</p><p>application.yml 指定接口全局路径前缀：</p><pre tabindex=0><code>servlet:
  context-path: /api
</code></pre><p>控制器注解：</p><pre tabindex=0><code>@RestController 适用于编写 restful 风格的 api，返回值默认为 json 类型
</code></pre><p>校验写在哪里？</p><ul><li>controller 层倾向于对请求参数本身的校验，不涉及业务逻辑本身（越少越好）</li><li>service 层是对业务逻辑的校验（有可能被 controller 之外的类调用）</li></ul><h3 id=如何知道是哪个用户登录了>如何知道是哪个用户登录了？<a hidden class=anchor aria-hidden=true href=#如何知道是哪个用户登录了>#</a></h3><blockquote><p>javaweb 这一块的知识</p></blockquote><ol><li><p>连接服务器端后，得到一个 session 状态（匿名会话），返回给前端</p></li><li><p>登录成功后，得到了登录成功的 session，并且给该sessio n设置一些值（比如用户信息），返回给前端一个设置 cookie 的 ”命令“</p><p><strong>session => cookie</strong></p></li><li><p>前端接收到后端的命令后，设置 cookie，保存到浏览器内</p></li><li><p>前端再次请求后端的时候（相同的域名），在请求头中带上cookie去请求</p></li><li><p>后端拿到前端传来的 cookie，找到对应的 session</p></li><li><p>后端从 session 中可以取出基于该 session 存储的变量（用户的登录信息、登录名）</p></li></ol><h2 id=用户管理>用户管理<a hidden class=anchor aria-hidden=true href=#用户管理>#</a></h2><p>接口设计关键：必须鉴权！！！</p><ol><li>查询用户（允许根据用户名查询）</li><li>删除用户</li></ol><h2 id=写代码流程>写代码流程<a hidden class=anchor aria-hidden=true href=#写代码流程>#</a></h2><ol><li>先做设计</li><li>代码实现</li><li>持续优化！！！（复用代码、提取公共逻辑 / 常量）</li></ol><h2 id=前后端交互>前后端交互<a hidden class=anchor aria-hidden=true href=#前后端交互>#</a></h2><p>前端需要向后端发送请求才能获取数据 / 执行操作。</p><p>怎么发请求：前端使用 ajax 来请求后端</p><h3 id=前端请求库及封装关系>前端请求库及封装关系<a hidden class=anchor aria-hidden=true href=#前端请求库及封装关系>#</a></h3><ul><li><p>axios 封装了 ajax</p></li><li><p>request 是 ant design 项目又封装了一次</p></li></ul><p>追踪 request 源码：用到了 umi 的插件、requestConfig 配置文件</p><h2 id=代理>代理<a hidden class=anchor aria-hidden=true href=#代理>#</a></h2><p>正向代理：替客户端向服务器发送请求，可以解决跨域问题</p><p>反向代理：替服务器统一接收请求。</p><p>怎么实现代理？</p><ul><li>Nginx 服务器</li><li>Node.js 服务器</li></ul><h3 id=举例>举例<a hidden class=anchor aria-hidden=true href=#举例>#</a></h3><p>原本请求：http://localhost:8000/api/user/login</p><p>代理到请求：http://localhost:8080/api/user/login</p><p><img loading=lazy src=https://qiniuyun.code-nav.cn/img/image-20220319005859098.png alt></p><h2 id=前端框架介绍>前端框架介绍<a hidden class=anchor aria-hidden=true href=#前端框架介绍>#</a></h2><h3 id=ant-design-proumi-框架权限管理>Ant Design Pro（Umi 框架）权限管理<a hidden class=anchor aria-hidden=true href=#ant-design-proumi-框架权限管理>#</a></h3><ul><li>app.tsx：项目全局入口文件，定义了整个项目中使用的公共数据（比如用户信息）</li><li>access.ts 控制用户的访问权限</li></ul><p>获取初始状态流程：首次访问页面（刷新页面），进入 app.tsx，执行 getInitialState 方法，该方法的返回值就是全局可用的状态值。</p><h3 id=procomponents-高级表单>ProComponents 高级表单<a hidden class=anchor aria-hidden=true href=#procomponents-高级表单>#</a></h3><ol><li>通过 columns 定义表格有哪些列</li><li>columns 属性<ul><li>dataIndex 对应返回数据对象的属性</li><li>title 表格列名</li><li>copyable 是否允许复制</li><li>ellipsis 是否允许缩略</li><li>valueType：用于声明这一列的类型（dateTime、select）</li></ul></li></ol><h3 id=框架关系>框架关系<a hidden class=anchor aria-hidden=true href=#框架关系>#</a></h3><p>Ant Design 组件库 => 基于 React 实现</p><p>Ant Design Procomponents => 基于 Ant Design 实现</p><p>Ant Design Pro 后台管理系统 => 基于 Ant Design + React + Ant Design Procomponents + 其他的库实现</p><h3 id=其他知识>其他知识<a hidden class=anchor aria-hidden=true href=#其他知识>#</a></h3><p>MFSU：前端编译优化</p><h2 id=后端优化>后端优化<a hidden class=anchor aria-hidden=true href=#后端优化>#</a></h2><h3 id=通用返回对象>通用返回对象<a hidden class=anchor aria-hidden=true href=#通用返回对象>#</a></h3><p>目的：给对象补充一些信息，告诉前端这个请求在业务层面上是成功还是失败</p><p>200、404、500、502、503</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;yupi&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>↓</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 成功
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;code&#34;</span>: <span style=color:#ae81ff>0</span> <span style=color:#75715e>// 业务状态码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#e6db74>&#34;data&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;yupi&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>	<span style=color:#f92672>&#34;message&#34;</span>: <span style=color:#e6db74>&#34;ok&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 错误
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;code&#34;</span>: <span style=color:#ae81ff>50001</span> <span style=color:#75715e>// 业务状态码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#e6db74>&#34;data&#34;</span>: <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;message&#34;</span>: <span style=color:#e6db74>&#34;用户操作异常、xxx&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>自定义错误码，返回类支持返回正常和错误</p><h3 id=封装全局异常处理器>封装全局异常处理器<a hidden class=anchor aria-hidden=true href=#封装全局异常处理器>#</a></h3><h3 id=实现-1>实现<a hidden class=anchor aria-hidden=true href=#实现-1>#</a></h3><ol><li><p>定义业务异常类</p><ol><li>相对于 java 的异常类，支持更多字段</li><li>自定义构造函数，更灵活 / 快捷的设置字段</li></ol></li><li><p>编写全局异常处理器（利用 Spring AOP，在调用方法前后进行额外的处理）</p></li></ol><h3 id=作用>作用<a hidden class=anchor aria-hidden=true href=#作用>#</a></h3><ol><li>捕获代码中所有的异常，内部消化，让前端得到更详细的业务报错 / 信息</li><li>同时屏蔽掉项目框架本身的异常（不暴露服务器内部状态）</li><li>集中处理，比如记录日志</li></ol><h2 id=前端优化>前端优化<a hidden class=anchor aria-hidden=true href=#前端优化>#</a></h2><blockquote><p>直播的 0：00 - 0：35 为踩坑过程，可跳过</p></blockquote><h3 id=全局响应处理>全局响应处理<a hidden class=anchor aria-hidden=true href=#全局响应处理>#</a></h3><p>应用场景：我们需要对接口的 <strong>通用响应</strong> 进行统一处理，比如从 response 中取出 data；或者根据 code 去集中处理错误，比如用户未登录、没权限之类的。</p><p>优势：不用在每个接口请求中都去写相同的逻辑</p><p>实现：参考你用的请求封装工具的官方文档，比如 umi-request（https://github.com/umijs/umi-request#interceptor、https://blog.csdn.net/huantai3334/article/details/116780020）。如果你用 <strong>axios</strong>，参考 axios 的文档。</p><p>创建新的文件，在该文件中配置一个全局请求类。在发送请求时，使用我们自己的定义的全局请求类。</p><h2 id=用户校验>用户校验<a hidden class=anchor aria-hidden=true href=#用户校验>#</a></h2><blockquote><p>仅适用于用户可信的情况</p></blockquote><p>先让用户自己填：2 - 5 位编号，全凭自觉。</p><p>后台补充对编号的校验：长度校验、唯一性校验</p><p>前端补充输入框，适配后端。</p><blockquote><p>后期拉取星球数据，定期清理违规用户</p></blockquote><h2 id=多环境>多环境<a hidden class=anchor aria-hidden=true href=#多环境>#</a></h2><p>参考文章：https://blog.csdn.net/weixin_41701290/article/details/120173283</p><p>本地开发：localhost（127.0.0.1）</p><p>多环境：指同一套项目代码在不同的阶段需要根据实际情况来调整配置并且部署到不同的机器上。</p><p>为什么需要？</p><ol><li>每个环境互不影响</li><li>区分不同的阶段：开发 / 测试 / 生产</li><li>对项目进行优化：<ol><li>本地日志级别</li><li>精简依赖，节省项目体积</li><li>项目的环境 / 参数可以调整，比如 JVM 参数</li></ol></li></ol><p>针对不同环境做不同的事情。</p><p>多环境分类：</p><ol><li>本地环境（自己的电脑）localhost</li><li>开发环境（远程开发）大家连同一台机器，为了大家开发方便</li><li>测试环境（测试）开发 / 测试 / 产品，单元测试 / 性能测试 / 功能测试 / 系统集成测试，独立的数据库、独立的服务器</li><li>预发布环境（体验服）：和正式环境一致，正式数据库，更严谨，查出更多问题</li><li>正式环境（线上，公开对外访问的项目）：尽量不要改动，保证上线前的代码是 “完美” 运行</li><li>沙箱环境（实验环境）：为了做实验</li></ol><h3 id=前端多环境实战>前端多环境实战<a hidden class=anchor aria-hidden=true href=#前端多环境实战>#</a></h3><ul><li><p>请求地址</p><ul><li><p>开发环境：localhost:8000</p></li><li><p>线上环境：user-backend.code-nav.cn</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>startFront</span>(<span style=color:#a6e22e>env</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>env</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;prod&#39;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 不输出注释 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// 项目优化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// 修改请求地址
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 保持本地开发逻辑
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>用了 umi 框架，build 时会自动传入 NODE_ENV == production 参数，start NODE_ENV 参数为 development</p></li><li><p>启动方式</p><ul><li>开发环境：npm run start（本地启动，监听端口、自动更新）</li><li>线上环境：npm run build（项目构建打包），可以使用 serve 工具启动（npm i -g serve）</li></ul></li><li><p>项目的配置</p><p>不同的项目（框架）都有不同的配置文件，umi 的配置文件是 config，可以在配置文件后添加对应的环境名称后缀来区分开发环境和生产环境。参考文档：https://umijs.org/zh-CN/docs/deployment</p><ul><li>开发环境：config.dev.ts</li><li>生产环境：config.prod.ts</li><li>公共配置：config.ts 不带后缀</li></ul></li></ul><h3 id=后端多环境实战>后端多环境实战<a hidden class=anchor aria-hidden=true href=#后端多环境实战>#</a></h3><p>SpringBoot 项目，通过 application.yml 添加不同的后缀来区分配置文件</p><p>可以在启动项目时传入环境变量：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>java -jar .<span style=color:#ae81ff>\u</span>ser-center-backend-0.0.1-SNAPSHOT.jar --spring.profiles.active<span style=color:#f92672>=</span>prod
</span></span></code></pre></div><p>主要是改：</p><ul><li><p>依赖的环境地址</p><ul><li><p>数据库地址</p></li><li><p>缓存地址</p></li><li><p>消息队列地址</p></li><li><p>项目端口号</p></li></ul></li><li><p>服务器配置</p></li></ul><h2 id=项目部署>项目部署<a hidden class=anchor aria-hidden=true href=#项目部署>#</a></h2><p>参考文章：https://www.bilibili.com/read/cv16179200</p><p>需要 Linux 服务器（建议大家用 CentOS 8+ / 7.6 以上）</p><h3 id=原始部署>原始部署<a hidden class=anchor aria-hidden=true href=#原始部署>#</a></h3><p>什么都自己装</p><h4 id=前端>前端<a hidden class=anchor aria-hidden=true href=#前端>#</a></h4><p>需要 web 服务器：<strong>nginx</strong> 、apache、tomcat</p><p>安装 nginx 服务器：</p><ol><li><p>用系统自带的软件包管理器快速安装，比如 centos 的 yum</p></li><li><p>自己到官网安装（参考文章）</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -o nginx-1.21.6.tar.gz http://nginx.org/download/nginx-1.21.6.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tar -zxvf nginx-1.21.6.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd nginx-1.21.6
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>37</span>  2022-04-17 23:30:09 yum install pcre pcre-devel -y
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>39</span>  2022-04-17 23:30:59 yum install openssl openssl-devel -y
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>41</span>  2022-04-17 23:31:57 ./configure --with-http_ssl_module --with-http_v2_module --with-stream
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>42</span>  2022-04-17 23:32:13 make
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>43</span>  2022-04-17 23:32:54 make install
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>48</span>  2022-04-17 23:33:40 ls /usr/local/nginx/sbin/nginx
</span></span><span style=display:flex><span>   vim /etc/profile
</span></span><span style=display:flex><span>  在最后一行添加：export PATH<span style=color:#f92672>=</span>$PATH:/usr/local/nginx/sbin	
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  nginx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  netstat -ntlp 查看启动情况
</span></span></code></pre></div><p>注意 nginx 权限</p></li></ol><h4 id=后端>后端<a hidden class=anchor aria-hidden=true href=#后端>#</a></h4><p>java、maven</p><p>安装：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum install -y java-1.8.0-openjdk*
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl -o apache-maven-3.8.5-bin.tar.gz https://dlcdn.apache.org/maven/maven-3/3.8.5/binaries/apache-maven-3.8.5-bin.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>git clone xxx 下载代码
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>打包构建，跳过测试
</span></span><span style=display:flex><span>mvn package -DskipTests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>java -jar ./user-center-backend-0.0.1-SNAPSHOT.jar --spring.profiles.active<span style=color:#f92672>=</span>prod
</span></span></code></pre></div><h3 id=宝塔-linux-部署>宝塔 Linux 部署<a hidden class=anchor aria-hidden=true href=#宝塔-linux-部署>#</a></h3><p>Linux 运维面板</p><p>官方安装教程：https://www.bt.cn/new/download.html</p><p>方便管理服务器、方便安装软件</p><h3 id=前端托管>前端托管<a hidden class=anchor aria-hidden=true href=#前端托管>#</a></h3><p>前端腾讯云 web 应用托管（比容器化更傻瓜式，不需要自己写构建应用的命令，就能启动前端项目）</p><blockquote><p><a href=https://console.cloud.tencent.com/webify/new>https://console.cloud.tencent.com/webify/new</a></p></blockquote><ul><li>小缺点：需要将代码放到代码托管平台上</li><li>优势：不用写命令、代码更新时自动构建</li></ul><h3 id=docker-部署>Docker 部署<a hidden class=anchor aria-hidden=true href=#docker-部署>#</a></h3><p>docker 是容器，可以将项目的环境（比如 java、nginx）和项目的代码一起打包成镜像，所有同学都能下载镜像，更容易分发和移植。</p><p>再启动项目时，不需要敲一大堆命令，而是直接下载镜像、启动镜像就可以了。</p><p>docker 可以理解为软件安装包。</p><p>Docker 安装：https://www.docker.com/get-started/ 或者宝塔安装</p><p>Dockerfile 用于指定构建 Docker 镜像的方法</p><p>Dockerfile 一般情况下不需要完全从 0 自己写，建议去 github、gitee 等托管平台参考同类项目（比如 springboot）</p><p>Dockerfile 编写：</p><ul><li>FROM 依赖的基础镜像</li><li>WORKDIR 工作目录</li><li>COPY 从本机复制文件</li><li>RUN 执行命令</li><li>CMD / ENTRYPOINT（附加额外参数）指定运行容器时默认执行的命令</li></ul><p>根据 Dockerfile 构建镜像：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 后端</span>
</span></span><span style=display:flex><span>docker build -t user-center-backend:v0.0.1 .
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 前端</span>
</span></span><span style=display:flex><span>docker build -t user-center-front:v0.0.1 .
</span></span></code></pre></div><p>Docker 构建优化：减少尺寸、减少构建时间（比如多阶段构建，可以丢弃之前阶段不需要的内容）</p><p>docker run 启动：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 前端</span>
</span></span><span style=display:flex><span>docker run -p 80:80 -d user-center-frontend:v0.0.1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 后端</span>
</span></span><span style=display:flex><span>docker run -p 8080:8080 user-center-backend:v0.0.1
</span></span></code></pre></div><p>虚拟化</p><ol><li>端口映射：把本机的资源（实际访问地址）和容器内部的资源（应用启动端口）进行关联</li><li>目录映射：把本机的端口和容器应用的端口进行关联</li></ol><p>进入容器：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec -i -t  fee2bbb7c9ee /bin/bash
</span></span></code></pre></div><p>查看进程：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker ps 
</span></span></code></pre></div><p>查看日志：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker logs -f <span style=color:#f92672>[</span>container-id<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>杀死容器：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker kill
</span></span></code></pre></div><p>强制删除镜像：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker rmi -f
</span></span></code></pre></div><h3 id=docker-平台部署>Docker 平台部署<a hidden class=anchor aria-hidden=true href=#docker-平台部署>#</a></h3><ol><li>云服务商的容器平台（腾讯云、阿里云）</li><li>面向某个领域的容器平台（前端 / 后端微信云托管）<strong>要花钱！</strong></li></ol><p>容器平台的好处：</p><ol><li>不用输命令来操作，更方便省事</li><li>不用在控制台操作，更傻瓜式、更简单</li><li>大厂运维，比自己运维更省心</li><li>额外的能力，比如监控、告警、其他（存储、负载均衡、自动扩缩容、流水线）</li></ol><p>爽就完事了！！！</p><h2 id=绑定域名>绑定域名<a hidden class=anchor aria-hidden=true href=#绑定域名>#</a></h2><p>前端项目访问流程：用户输入网址 => 域名解析服务器（把网址解析为 ip 地址 / 交给其他的域名解析服务） => 服务器 =>（防火墙）=> nginx 接收请求，找到对应的文件，返回文件给前端 => 前端加载文件到浏览器中（js、css） => 渲染页面</p><p>后端项目访问流程：用户输入网址 => 域名解析服务器 => 服务器 => nginx 接收请求 => 后端项目（比如 8080端口）</p><p>nginx 反向代理的作用：替服务器接收请求，转发请求</p><h2 id=跨域问题解决>跨域问题解决<a hidden class=anchor aria-hidden=true href=#跨域问题解决>#</a></h2><p>浏览器为了用户的安全，仅允许向 <strong>同域名、同端口</strong> 的服务器发送请求。</p><p>如何解决跨域？</p><p>最直接的方式：把域名、端口改成相同的</p><h3 id=添加跨域头>添加跨域头<a hidden class=anchor aria-hidden=true href=#添加跨域头>#</a></h3><p>让服务器告诉浏览器：允许跨域（返回 cross-origin-allow 响应头）</p><h4 id=1-网关支持nginx>1. 网关支持（Nginx）<a hidden class=anchor aria-hidden=true href=#1-网关支持nginx>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#75715e># 跨域配置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>location</span> <span style=color:#e6db74>^~</span> <span style=color:#e6db74>/api/</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://127.0.0.1:8080/api/</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>&#39;Access-Control-Allow-Origin&#39;</span> $http_origin;
</span></span><span style=display:flex><span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>&#39;Access-Control-Allow-Credentials&#39;</span> <span style=color:#e6db74>&#39;true&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>Access-Control-Allow-Methods</span> <span style=color:#e6db74>&#39;GET,</span> <span style=color:#e6db74>POST,</span> <span style=color:#e6db74>OPTIONS&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>Access-Control-Allow-Headers</span> <span style=color:#e6db74>&#39;*&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>if</span> <span style=color:#e6db74>(</span>$request_method = <span style=color:#e6db74>&#39;OPTIONS&#39;)</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>add_header</span> <span style=color:#e6db74>&#39;Access-Control-Allow-Credentials&#39;</span> <span style=color:#e6db74>&#39;true&#39;</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>add_header</span> <span style=color:#e6db74>&#39;Access-Control-Allow-Origin&#39;</span> $http_origin;
</span></span><span style=display:flex><span>        <span style=color:#f92672>add_header</span> <span style=color:#e6db74>&#39;Access-Control-Allow-Methods&#39;</span> <span style=color:#e6db74>&#39;GET,</span> <span style=color:#e6db74>POST,</span> <span style=color:#e6db74>OPTIONS&#39;</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>add_header</span> <span style=color:#e6db74>&#39;Access-Control-Allow-Headers&#39;</span> <span style=color:#e6db74>&#39;DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range&#39;</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>add_header</span> <span style=color:#e6db74>&#39;Access-Control-Max-Age&#39;</span> <span style=color:#ae81ff>1728000</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>add_header</span> <span style=color:#e6db74>&#39;Content-Type&#39;</span> <span style=color:#e6db74>&#39;text/plain</span>; <span style=color:#f92672>charset=utf-8&#39;</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>add_header</span> <span style=color:#e6db74>&#39;Content-Length&#39;</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>return</span> <span style=color:#ae81ff>204</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=2-修改后端服务>2. 修改后端服务<a hidden class=anchor aria-hidden=true href=#2-修改后端服务>#</a></h4><ol><li><p>配置 @CrossOrigin 注解</p></li><li><p>添加 web 全局请求拦截器</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WebMvcConfg</span> <span style=color:#66d9ef>implements</span> WebMvcConfigurer <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addCorsMappings</span><span style=color:#f92672>(</span>CorsRegistry registry<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//设置允许跨域的路径
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        registry<span style=color:#f92672>.</span><span style=color:#a6e22e>addMapping</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/**&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>//设置允许跨域请求的域名
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#75715e>//当**Credentials为true时，**Origin不能为星号，需为具体的ip地址【如果接口不带cookie,ip无需设成具体ip】
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>allowedOrigins</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;http://localhost:9527&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;http://127.0.0.1:9527&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;http://127.0.0.1:8082&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;http://127.0.0.1:8083&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>//是否允许证书 不再默认开启
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>allowCredentials</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>//设置允许的方法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>allowedMethods</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;*&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>//跨域允许时间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>maxAge</span><span style=color:#f92672>(</span>3600<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div></li><li><p>定义新的 corsFilter Bean，参考：https://www.jianshu.com/p/b02099a435bd</p></li></ol><h2 id=项目优化点>项目优化点<a hidden class=anchor aria-hidden=true href=#项目优化点>#</a></h2><ol><li>功能扩充<ol><li>管理员创建用户、修改用户信息、删除用户</li><li>上传头像</li><li>按照更多的条件去查询用户</li><li>更改权限</li></ol></li><li>修改 Bug</li><li>项目登录改为分布式 session（单点登录 - redis）</li><li>通用性<ol><li>set-cookie domain 域名更通用，比如改为 *.xxx.com</li><li>把用户管理系统 => 用户中心（之后所有的服务都请求这个后端）</li></ol></li><li>后台添加全局请求拦截器（统一去判断用户权限、统一记录请求日志）</li></ol></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://nightingale777.github.io/MyBlog/>My New Hugo Site</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>